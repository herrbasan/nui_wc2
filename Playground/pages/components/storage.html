<header>
	<h1>Storage</h1>
	<p>Minimal text storage helper for cookies and localStorage with TTL support</p>
</header>

<section>
	<h2>Overview</h2>
	<p>The <code>nui.util.storage</code> object provides a simple getter/setter API for storing text values. It's designed for simple use cases like theme preferences, session tokens, or user settings—not complex data.</p>
	<p><strong>Key features:</strong></p>
	<ul>
		<li>Unified API for cookies and localStorage</li>
		<li>Flexible TTL (time-to-live) formats</li>
		<li>Automatic expiry checking on read</li>
		<li>Secure cookie defaults (SameSite=Lax, Secure on HTTPS)</li>
		<li>Synchronous API—no promises needed</li>
		<li>String API (values are strings); localStorage uses an internal JSON wrapper for expiry metadata</li>
	</ul>
</section>

<section>
	<h2>Basic Usage</h2>
	<p>Store and retrieve values with sensible defaults:</p>
	<nui-code>
		<script type="example" data-lang="js">
// Store a value (cookie, forever)
nui.util.storage.set({ name: 'theme', value: 'dark' });

// Retrieve a value
const theme = nui.util.storage.get({ name: 'theme' }); // 'dark' or undefined

// Remove a value
nui.util.storage.remove({ name: 'theme' }); // true if existed, false otherwise
		</script>
	</nui-code>
	<h3>Try It</h3>
	<nui-button-container gap="1rem">
		<nui-button><button type="button" data-action="storage-set-theme">Set theme=dark</button></nui-button>
		<nui-button><button type="button" data-action="storage-get-theme">Get theme</button></nui-button>
		<nui-button><button type="button" data-action="storage-remove-theme">Remove theme</button></nui-button>
	</nui-button-container>
	<div class="demo-result">
		<pre id="storage-result">Result: -</pre>
	</div>
</section>

<section>
	<h2>Storage Targets</h2>
	<p>Choose where to store your data:</p>
	<nui-code>
		<script type="example" data-lang="js">
// Cookie (default)
nui.util.storage.set({ name: 'token', value: 'abc123' });

// localStorage
nui.util.storage.set({ name: 'prefs', value: 'compact', target: 'localStorage' });

// Get from specific target
nui.util.storage.get({ name: 'prefs', target: 'localStorage' });
		</script>
	</nui-code>
	<nui-table>
		<table>
			<thead>
				<tr>
					<th>Target</th>
					<th>Persistence</th>
					<th>Size Limit</th>
					<th>Sent to Server</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>cookie</code></td>
					<td>Configurable (TTL)</td>
					<td>~4KB per cookie</td>
					<td>Yes (every request)</td>
				</tr>
				<tr>
					<td><code>localStorage</code></td>
					<td>Configurable (TTL)</td>
					<td>~5-10MB total</td>
					<td>No</td>
				</tr>
			</tbody>
		</table>
	</nui-table>
</section>

<section>
	<h2>TTL (Time-to-Live)</h2>
	<p>Control when stored values expire using flexible TTL formats:</p>
	<nui-code>
		<script type="example" data-lang="js">
// Forever (default) - 10 years for cookies
nui.util.storage.set({ name: 'pref', value: 'x' });
nui.util.storage.set({ name: 'pref', value: 'x', ttl: 'forever' });

// Session - deleted when browser closes (cookies only)
nui.util.storage.set({ name: 'session', value: 'temp', ttl: 'session' });

// Relative time
nui.util.storage.set({ name: 'cache', value: 'data', ttl: '30-minutes' });
nui.util.storage.set({ name: 'token', value: 'abc', ttl: '2-hours' });
nui.util.storage.set({ name: 'remember', value: 'me', ttl: '7-days' });
nui.util.storage.set({ name: 'annual', value: 'sub', ttl: '1-year' });

// Specific date (expires end of that day)
nui.util.storage.set({ name: 'promo', value: 'sale', ttl: '2025-12-31' });

// Epoch timestamp (milliseconds if > 1e12, otherwise seconds)
nui.util.storage.set({ name: 'exp', value: 'x', ttl: 1735689600000 });
		</script>
	</nui-code>
	<h3>Try It</h3>
	<nui-button-container gap="1rem">
		<nui-button><button type="button" data-action="storage-set-session">Set session cookie</button></nui-button>
		<nui-button><button type="button" data-action="storage-set-1min">Set 1-minute TTL</button></nui-button>
		<nui-button><button type="button" data-action="storage-get-demo">Get demo value</button></nui-button>
	</nui-button-container>
	<div class="demo-result">
		<pre id="ttl-result">Result: -</pre>
	</div>
</section>

<section>
	<h2>TTL Format Reference</h2>
	<nui-table>
		<table>
			<thead>
				<tr>
					<th>Format</th>
					<th>Example</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>forever</code></td>
					<td><code>'forever'</code></td>
					<td>Never expires (10 years for cookies)</td>
				</tr>
				<tr>
					<td><code>session</code></td>
					<td><code>'session'</code></td>
					<td>Expires when browser closes</td>
				</tr>
				<tr>
					<td><code>N-minutes</code></td>
					<td><code>'30-minutes'</code></td>
					<td>Expires in N minutes</td>
				</tr>
				<tr>
					<td><code>N-hours</code></td>
					<td><code>'2-hours'</code></td>
					<td>Expires in N hours</td>
				</tr>
				<tr>
					<td><code>N-days</code></td>
					<td><code>'7-days'</code></td>
					<td>Expires in N days</td>
				</tr>
				<tr>
					<td><code>N-months</code></td>
					<td><code>'3-months'</code></td>
					<td>Expires in N months</td>
				</tr>
				<tr>
					<td><code>N-years</code></td>
					<td><code>'1-year'</code></td>
					<td>Expires in N years</td>
				</tr>
				<tr>
					<td><code>YYYY-MM-DD</code></td>
					<td><code>'2025-12-31'</code></td>
					<td>Expires end of that date</td>
				</tr>
				<tr>
					<td>Epoch (ms)</td>
					<td><code>1735689600000</code></td>
					<td>Expires at timestamp (>1e12 = ms)</td>
				</tr>
				<tr>
					<td>Epoch (s)</td>
					<td><code>1735689600</code></td>
					<td>Expires at timestamp (≤1e12 = seconds)</td>
				</tr>
			</tbody>
		</table>
	</nui-table>
</section>

<section>
	<h2>Cookie Security</h2>
	<p>Cookies are created with secure defaults:</p>
	<ul>
		<li><strong>SameSite=Lax</strong> — Prevents CSRF attacks while allowing normal navigation</li>
		<li><strong>Secure</strong> — Automatically added when served over HTTPS</li>
		<li><strong>path=/</strong> — Cookie available site-wide</li>
	</ul>
	<nui-code>
		<script type="example" data-lang="js">
// Cookie created with these attributes:
// theme=dark; path=/; SameSite=Lax; Secure; expires=...
nui.util.storage.set({ name: 'theme', value: 'dark' });
		</script>
	</nui-code>
</section>

<section>
	<h2>API Reference</h2>
	
	<h3>set(options)</h3>
	<p>Store a value. Returns <code>true</code> on success, <code>false</code> on failure.</p>
	<nui-table>
		<table>
			<thead>
				<tr>
					<th>Option</th>
					<th>Type</th>
					<th>Default</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>name</code></td>
					<td>string</td>
					<td>(required)</td>
					<td>Storage key name</td>
				</tr>
				<tr>
					<td><code>value</code></td>
					<td>string</td>
					<td>(required)</td>
					<td>Value to store (text only)</td>
				</tr>
				<tr>
					<td><code>target</code></td>
					<td>string</td>
					<td><code>'cookie'</code></td>
					<td><code>'cookie'</code> or <code>'localStorage'</code></td>
				</tr>
				<tr>
					<td><code>ttl</code></td>
					<td>string | number</td>
					<td><code>'forever'</code></td>
					<td>Time-to-live (see formats above)</td>
				</tr>
			</tbody>
		</table>
	</nui-table>
	
	<h3>get(options)</h3>
	<p>Retrieve a value. Returns the value or <code>undefined</code> if not found or expired.</p>
	<nui-table>
		<table>
			<thead>
				<tr>
					<th>Option</th>
					<th>Type</th>
					<th>Default</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>name</code></td>
					<td>string</td>
					<td>(required)</td>
					<td>Storage key name</td>
				</tr>
				<tr>
					<td><code>target</code></td>
					<td>string</td>
					<td><code>'cookie'</code></td>
					<td><code>'cookie'</code> or <code>'localStorage'</code></td>
				</tr>
			</tbody>
		</table>
	</nui-table>
	
	<h3>remove(options)</h3>
	<p>Remove a stored value. Returns <code>true</code> if the value existed and was removed, <code>false</code> otherwise.</p>
	<nui-table>
		<table>
			<thead>
				<tr>
					<th>Option</th>
					<th>Type</th>
					<th>Default</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>name</code></td>
					<td>string</td>
					<td>(required)</td>
					<td>Storage key name</td>
				</tr>
				<tr>
					<td><code>target</code></td>
					<td>string</td>
					<td><code>'cookie'</code></td>
					<td><code>'cookie'</code> or <code>'localStorage'</code></td>
				</tr>
			</tbody>
		</table>
	</nui-table>
</section>

<section>
	<h2>Practical Examples</h2>
	<nui-code>
		<script type="example" data-lang="js">
// Remember user's theme preference
const theme = nui.util.storage.get({ name: 'theme' }) || 'light';
document.documentElement.style.colorScheme = theme;

function toggleTheme() {
	const current = nui.util.storage.get({ name: 'theme' }) || 'light';
	const next = current === 'dark' ? 'light' : 'dark';
	nui.util.storage.set({ name: 'theme', value: next });
	document.documentElement.style.colorScheme = next;
}

// Session token with expiry
nui.util.storage.set({ 
	name: 'auth-token', 
	value: 'jwt-token-here', 
	ttl: '2-hours' 
});

// Check if token exists
if (nui.util.storage.get({ name: 'auth-token' })) {
	// User is authenticated
}

// Clear on logout
nui.util.storage.remove({ name: 'auth-token' });

// Use localStorage for larger data
nui.util.storage.set({
	name: 'user-settings',
	value: 'sidebar:collapsed,density:compact',
	target: 'localStorage',
	ttl: '30-days'
});
		</script>
	</nui-code>
</section>

<script type="nui/page">
const resultEl = document.getElementById('storage-result');

function showResult(text) {
	resultEl.textContent = 'Result: ' + text;
}

document.addEventListener('click', (e) => {
	const action = e.target.closest('[data-action]')?.dataset.action;
	if (!action) return;
	
	switch (action) {
		case 'storage-set-theme': {
			const success = nui.util.storage.set({ name: 'theme', value: 'dark' });
			showResult(success ? 'Set theme=dark (cookie)' : 'Failed to set');
			break;
		}
		case 'storage-get-theme': {
			const theme = nui.util.storage.get({ name: 'theme' });
			showResult(theme !== undefined ? `theme = "${theme}"` : 'theme not found');
			break;
		}
		case 'storage-remove-theme': {
			const removed = nui.util.storage.remove({ name: 'theme' });
			showResult(removed ? 'Removed theme cookie' : 'theme did not exist');
			break;
		}
		case 'storage-set-session':
			nui.util.storage.set({ name: 'demo', value: 'session-value', ttl: 'session' });
			document.getElementById('ttl-result').textContent = 'Set demo=session-value (session cookie - closes with browser)';
			break;
		case 'storage-set-1min':
			nui.util.storage.set({ name: 'demo', value: 'expires-soon', ttl: '1-minute' });
			document.getElementById('ttl-result').textContent = 'Set demo=expires-soon (expires in 1 minute)';
			break;
		case 'storage-get-demo': {
			const demo = nui.util.storage.get({ name: 'demo' });
			document.getElementById('ttl-result').textContent = demo !== undefined ? `demo = "${demo}"` : 'demo not found or expired';
			break;
		}
	}
});
</script>
