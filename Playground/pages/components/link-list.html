<section>
	<h1>Link List Component</h1>
	<p>
		The <code>&lt;nui-link-list&gt;</code> component provides hierarchical navigation with multiple modes:
		<strong>fold</strong> (accordion - one group open at a time) and <strong>tree</strong> (all groups can be open).
	</p>
	
	<h2>Usage Modes</h2>
	<ul>
		<li><strong>Fold Mode (Accordion):</strong> <code>&lt;nui-link-list mode="fold"&gt;</code> - Opening one group closes others</li>
		<li><strong>Tree Mode:</strong> <code>&lt;nui-link-list mode="tree"&gt;</code> - All groups can be open simultaneously</li>
	</ul>

    <h2>Live Demo: Fold Mode (Accordion)</h2>
	<p>In fold mode, only one group can be open at a time. Opening a group automatically closes others:</p>
	<div class="link_list_fold_container">
		<nui-link-list id="demo-fold" mode="fold">
			<!-- Loaded via JavaScript -->
		</nui-link-list>
	</div>
	
	<h3>Interactive Testing (Fold Mode)</h3>
	<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
		<nui-button data-action="set-active-fold:ESLint">
			<button type="button">Set Active: ESLint</button>
		</nui-button>
		<nui-button data-action="get-active-fold">
			<button type="button">Get Active State</button>
		</nui-button>
		<nui-button data-action="clear-active-fold">
			<button type="button">Clear Active & Close All</button>
		</nui-button>
	</div>
	
	<div style="background: var(--nui-surface-2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
		<h4 style="margin-top: 0;">Fold Mode State:</h4>
		<pre id="fold-state-display" style="margin: 0; font-family: monospace; font-size: 0.875rem;">No active item</pre>
	</div>
	
	<h2>Live Demo: Tree Mode (Masonry Layout)</h2>
	<p>In tree mode, all groups can be open simultaneously. The masonry layout arranges groups in columns for efficient space usage:</p>
	<div class="link_list_column_container">
		<nui-link-list id="demo-tree" mode="tree">
			<nui-column-flow column-width="/3" sort="height">
			<nui-column-flow column-width="/3" sort="height">
				<ul>
				<li class="group-header">
					<span>
						<nui-icon name="wysiwyg"></nui-icon>
						<span>Content & Windows</span>
					</span>
					<button type="button" class="action" data-action="edit-section:content">
						<nui-icon name="settings"></nui-icon>
					</button>
				</li>
					<li>
						<a href="#content">
							<span>Content</span>
						</a>
					</li>
					<li>
						<a href="#windows">
							<span>Windows</span>
						</a>
					</li>
				</ul>
				<ul>
					<li class="group-header">
						<span>
							<nui-icon name="empty_dashboard"></nui-icon>
							<span>Buttons & Fields</span>
						</span>
					</li>
					<li>
						<a href="#buttons">
							<span>Buttons</span>
						</a>
					</li>
					<li>
						<a href="#fields">
							<span>Fields</span>
						</a>
					</li>
				</ul>
				<ul>
					<li>
						<a href="#misc">
							<nui-icon name="label"></nui-icon>
							<span>Misc</span>
						</a>
					</li>
				</ul>
				<ul>
					<li class="group-header">
						<span>
							<nui-icon name="folder"></nui-icon>
							<span>Group</span>
						</span>
					</li>
					<li>
						<a href="#some">
							<span>Some Item</span>
						</a>
					</li>
					<li>
						<a href="#another">
							<span>Another Item</span>
						</a>
					</li>
					<ul>
						<li class="group-header">
							<span>
								<nui-icon name="calendar"></nui-icon>
								<span>Sub Group</span>
							</span>
						</li>
						<li>
							<a href="#sub1">
								<span>Subgroup Item 1</span>
							</a>
						</li>
						<li>
							<a href="#sub2">
								<span>Subgroup Item 2</span>
							</a>
						</li>
					</ul>
				</ul>
				<ul>
					<li class="group-header">
						<span>
							<nui-icon name="filter_list"></nui-icon>
							<span>Functions & Objects</span>
						</span>
					</li>
					<li>
						<a href="#fnc1">
							<span>Function Item 1</span>
						</a>
					</li>
					<li>
						<a href="#fnc2">
							<span>Function Item 2</span>
						</a>
					</li>
					<li>
						<a href="#fnc3">
							<span>Function Item 3</span>
						</a>
					</li>
					<li class="separator"><hr></li>
					<li>
						<a href="#obj1">
							<span>Object Item 1</span>
						</a>
					</li>
					<li>
						<a href="#obj2">
							<span>Object Item 2</span>
						</a>
					</li>
				</ul>
				<ul>
					<li class="group-header">
						<span>
							<nui-icon name="monitor"></nui-icon>
							<span>Developer Tools</span>
						</span>
					</li>
					<li>
						<a href="#devtools-overview">
							<span>Overview</span>
						</a>
					</li>
					<ul>
						<li class="group-header">
							<span>
								<nui-icon name="settings"></nui-icon>
								<span>Build Tools</span>
							</span>
						</li>
						<li>
							<a href="#build-config">
								<span>Configuration</span>
							</a>
						</li>
						<li>
							<a href="#build-scripts">
								<span>Scripts</span>
							</a>
						</li>
						<ul>
							<li class="group-header">
								<span>
									<nui-icon name="layers"></nui-icon>
									<span>Plugins</span>
								</span>
							</li>
							<li>
								<a href="#plugin-babel">
									<span>Babel</span>
								</a>
							</li>
							<li>
								<a href="#plugin-webpack">
									<span>Webpack, a tool I truly hate, so I give it a title that reflects my feelings</span>
								</a>
							</li>
							<li>
								<a href="#plugin-eslint">
									<span>ESLint</span>
								</a>
							</li>
						</ul>
					</ul>
					<ul>
						<li class="group-header">
							<span>
								<nui-icon name="search"></nui-icon>
								<span>Testing</span>
							</span>
						</li>
						<li>
							<a href="#test-unit">
								<span>Unit Tests</span>
							</a>
						</li>
						<li>
							<a href="#test-integration">
								<span>Integration Tests</span>
							</a>
						</li>
						<li>
							<a href="#test-e2e">
								<span>E2E Tests</span>
							</a>
						</li>
					</ul>
				</ul>
			</nui-column-flow>
			</nui-column-flow>
		</nui-link-list>
	</div>

	<div style="background: var(--nui-surface-2); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0 2rem;">
		<h4 style="margin-top: 0;">Last Clicked Path:</h4>
		<pre id="tree-path-display" style="margin: 0; font-family: monospace; font-size: 0.875rem;">No item selected</pre>
	</div>
	
	<h2>HTML Structure Example</h2>
	<p>Basic structure with semantic HTML:</p>
	<nui-code>
		<pre><code data-lang="html">&lt;nui-link-list mode="fold"&gt;
	&lt;ul&gt;
		&lt;li class="group-header"&gt;
			&lt;span&gt;
				&lt;nui-icon name="folder"&gt;&lt;/nui-icon&gt;
				&lt;span&gt;Group Name&lt;/span&gt;
			&lt;/span&gt;
		&lt;/li&gt;
		&lt;li&gt;
			&lt;a href="#item"&gt;
				&lt;span&gt;Item Name&lt;/span&gt;
			&lt;/a&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
&lt;/nui-link-list&gt;</code></pre>
	</nui-code>
	
	<h2>JavaScript Data Structure</h2>
	<p>Generate navigation from JSON using <code>loadData()</code>:</p>
	<nui-code>
		<pre><code data-lang="js">const navigationData = [
	{
		label: 'Group Name',
		icon: 'folder',
		items: [
			{ label: 'Item 1', href: '#item1' },
			{ label: 'Item 2', href: '#item2' }
		]
	},
	{
		label: 'Nested Group',
		icon: 'layers',
		items: [
			{ label: 'Sub Item', href: '#sub' },
			{
				label: 'Sub Group',
				icon: 'calendar',
				items: [
					{ label: 'Deep Item', href: '#deep' }
				]
			}
		]
	},
	{
		label: 'Single Item',
		icon: 'label',
		href: '#single'
	}
];

const linkList = document.querySelector('nui-link-list');
linkList.loadData(navigationData);</code></pre>
	</nui-code>
	
	
	
	<h3>Interactive Testing (Tree Mode)</h3>
	<nui-button-contaier>
		<nui-button data-action="set-active-tree:Subgroup Item 1">
			<button type="button">Set Active: Sub Item</button>
		</nui-button>
		<nui-button data-action="get-active-tree">
			<button type="button">Get Active State</button>
		</nui-button>
		<nui-button data-action="clear-active-tree">
			<button type="button">Clear Active</button>
		</nui-button>
	</nui-button-container>
	
	<div style="background: var(--nui-surface-2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
		<h4 style="margin-top: 0;">Tree Mode State:</h4>
		<pre id="tree-state-display" style="margin: 0; font-family: monospace; font-size: 0.875rem;">No active item</pre>
	</div>
	
	<h2>API Reference</h2>
	<p>The link-list component provides methods for programmatic control:</p>
	
	<h3>Active State Management</h3>
	<nui-code>
		<pre><code data-lang="js">const linkList = document.querySelector('nui-link-list');

// Set active item (auto-expands parent groups)
linkList.setActive('a[href="#overview"]');

// Get current active element (returns &lt;li&gt;)
const activeElement = linkList.getActive();

// Get active data object
const data = linkList.getActiveData();
console.log(data.href);  // "#overview"
console.log(data.text);  // "Overview"

// Clear active state
linkList.clearActive();

// Clear active and close all groups
linkList.clearActive(true);</code></pre>
	</nui-code>
	
	<h3>Load from JSON</h3>
	<nui-code>
		<pre><code>// Generate navigation from data structure
linkList.loadData(navigationData);</code></pre>
	</nui-code>
	
	<h2>Complete Navigation Data Structure</h2>
	<p>This is the data structure used in the live examples above:</p>
	<details class="collapsible-section">
		<summary>View Navigation Data Structure</summary>
		<div>
			<pre><code id="nav-structure-code">// Navigation data will be loaded here</code></pre>
		</div>
	</details>
	
	<h2>Advanced Features</h2>
	
	<h3>Column Flow Layout</h3>
	<p>Use <code>&lt;nui-column-flow&gt;</code> for multi-column tree layouts:</p>
	<nui-code>
		<pre><code data-lang="html">&lt;nui-link-list mode="tree"&gt;
	&lt;nui-column-flow column-width="/3" sort="height"&gt;
		&lt;!-- Tree structure here --&gt;
	&lt;/nui-column-flow&gt;
&lt;/nui-link-list&gt;</code></pre>
	</nui-code>
	
	<h3>Action Buttons</h3>
	<p>Add action buttons to group headers:</p>
	<nui-code>
		<pre><code data-lang="html">&lt;li class="group-header"&gt;
	&lt;span&gt;
		&lt;nui-icon name="folder"&gt;&lt;/nui-icon&gt;
		&lt;span&gt;Group Name&lt;/span&gt;
	&lt;/span&gt;
	&lt;button type="button" class="action" data-action="edit-group"&gt;
		&lt;nui-icon name="settings"&gt;&lt;/nui-icon&gt;
	&lt;/button&gt;
&lt;/li&gt;</code></pre>
	</nui-code>
	
	<h3>Separators</h3>
	<p>Add visual separators between items:</p>
	<nui-code>
		<pre><code data-lang="html">&lt;li class="separator"&gt;&lt;hr&gt;&lt;/li&gt;</code></pre>
	</nui-code>
	
	<h2>Accessibility</h2>
	<p>The link-list component implements ARIA tree patterns:</p>
	<ul>
		<li><code>role="tree"</code> on container</li>
		<li><code>role="group"</code> on collapsible sections</li>
		<li><code>role="treeitem"</code> on items</li>
		<li>Arrow key navigation for keyboard users</li>
		<li>Auto-expand on focus to prevent keyboard traps</li>
	</ul>
	
</section>

<script type="nui/page">
function init(element, params) {
	// Navigation data structure
	const demoNavigationData = [
		{
			label: 'Content & Windows',
			icon: 'wysiwyg',
			items: [
				{ label: 'Content' },
				{ label: 'Windows' }
			]
		},
		{
			label: 'Buttons & Fields',
			icon: 'empty_dashboard',
			items: [
				{ label: 'Buttons' },
				{ label: 'Fields' }
			]
		},
		{
			label: 'Group',
			icon: 'folder',
			items: [
				{ label: 'Some Item' },
				{ label: 'Another Item' },
				{
					label: 'Sub Group',
					icon: 'calendar',
					items: [
						{ label: 'Subgroup Item 1' },
						{ label: 'Subgroup Item 2' }
					]
				}
			]
		},
		{
			label: 'Functions & Objects',
			icon: 'filter_list',
			items: [
				{ label: 'Function Item 1' },
				{ label: 'Function Item 2' },
				{ label: 'Function Item 3' },
				{ separator: true },
				{ label: 'Object Item 1' },
				{ label: 'Object Item 2' }
			]
		},
		{
			label: 'Developer Tools',
			icon: 'monitor',
			items: [
				{ label: 'Overview' },
				{
					label: 'Build Tools',
					icon: 'settings',
					items: [
						{ label: 'Configuration' },
						{ label: 'Scripts' },
						{
							label: 'Plugins',
							icon: 'layers',
							items: [
								{ label: 'Babel' },
								{ label: 'Webpack' },
								{ label: 'ESLint' }
							]
						}
					]
				},
				{
					label: 'Testing',
					icon: 'search',
					items: [
						{ label: 'Unit Tests' },
						{ label: 'Integration Tests' },
						{ label: 'E2E Tests' }
					]
				}
			]
		}
	];

	const demoFold = element.querySelector('#demo-fold');
	const demoTree = element.querySelector('#demo-tree');
	
	if (demoFold && demoFold.loadData) {
		demoFold.loadData(demoNavigationData);
	}
	
	if (demoTree && demoTree.loadData) {
		demoTree.loadData(demoNavigationData);
	}
	
	const codeBlock = element.querySelector('#nav-structure-code');
	if (codeBlock) {
		codeBlock.textContent = JSON.stringify(demoNavigationData, null, 2);
	}
	
	// Setup interactive testing
	const foldStateDisplay = element.querySelector('#fold-state-display');
	const treeStateDisplay = element.querySelector('#tree-state-display');
	const treePathDisplay = element.querySelector('#tree-path-display');
	const instanceId = 'link-list-page-' + Date.now();
	
	function updateFoldStateDisplay() {
		if (!foldStateDisplay || !demoFold) return;
		const foldData = demoFold.getActiveData?.();
		foldStateDisplay.textContent = foldData ? `Active Item:\n  ${foldData.text}` : 'No active item';
	}
	
	function updateTreeStateDisplay() {
		if (!treeStateDisplay || !demoTree) return;
		const treeData = demoTree.getActiveData?.();
		treeStateDisplay.textContent = treeData ? `Active Item:\n  ${treeData.text}` : 'No active item';
	}

	function getBreadcrumbFromItem(item) {
		if (!item) return [];
		const path = [];
		const anchor = item.querySelector('a') || item;
		const itemLabel = anchor.textContent.trim();
		if (itemLabel) path.unshift(itemLabel);

		let container = item.closest('.group-items');
		while (container) {
			const header = container.previousElementSibling?.closest('.group-header');
			if (!header) break;
			const labelSpan = header.querySelector('span span');
			const label = (labelSpan ? labelSpan.textContent : header.textContent || '').trim();
			if (label) path.unshift(label);
			container = header.closest('.group-items');
		}

		return path;
	}

	function updateTreePathDisplay(item = null) {
		if (!treePathDisplay) return;
		const targetItem = item || demoTree?.getActive?.();
		const path = getBreadcrumbFromItem(targetItem);
		treePathDisplay.textContent = path.length ? path.join(' / ') : 'No item selected';
	}
	
	// Handle actions
	element.addEventListener('click', (e) => {
		const actionEl = e.target.closest('[data-action]');
		if (!actionEl) return;
		
		const actionSpec = actionEl.dataset.action;
		if (!actionSpec) return;
		
		const [actionName, param] = actionSpec.split(':');
		
		if (actionName === 'set-active-fold') {
			const allLinks = Array.from(demoFold.querySelectorAll('a:has(span)'));
			const item = allLinks.find(link => link.textContent.trim() === param);
			if (item) demoFold.setActive(item);
			updateFoldStateDisplay();
		} else if (actionName === 'get-active-fold') {
			const foldData = demoFold.getActiveData?.();
						nui.components.dialog.alert('Active State', foldData ? `Fold Mode Active:\n\nText: ${foldData.text}` : 'Fold Mode: No active item');
			updateFoldStateDisplay();
		} else if (actionName === 'clear-active-fold') {
			demoFold.clearActive?.(true);
			updateFoldStateDisplay();
		} else if (actionName === 'set-active-tree') {
			const allLinks = Array.from(demoTree.querySelectorAll('a:has(span)'));
			const item = allLinks.find(link => link.textContent.trim() === param);
			if (item) demoTree.setActive(item);
			updateTreeStateDisplay();
			updateTreePathDisplay(item?.closest('li'));
		} else if (actionName === 'get-active-tree') {
			const treeData = demoTree.getActiveData?.();
						nui.components.dialog.alert('Active State', treeData ? `Tree Mode Active:\n\nText: ${treeData.text}` : 'Tree Mode: No active item');
			updateTreeStateDisplay();
			updateTreePathDisplay();
		} else if (actionName === 'clear-active-tree') {
			demoTree.clearActive?.();
			updateTreeStateDisplay();
			updateTreePathDisplay();
		}
	});
	
	// Watch for state changes using custom events
	if (demoFold) {
		demoFold.addEventListener('nui-active-change', () => updateFoldStateDisplay());
	}
	
	if (demoTree) {
		demoTree.addEventListener('nui-active-change', (e) => {
			updateTreeStateDisplay();
			updateTreePathDisplay(e.detail?.element);
		});
	}
	
	updateFoldStateDisplay();
	updateTreeStateDisplay();
	updateTreePathDisplay();
}
</script>